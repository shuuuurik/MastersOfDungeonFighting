## Диаграмма состояний: динамика игрового процесса

Данная диаграмма состояний визуализирует **динамическое поведение** ключевых элементов системы MastersOfDungeonFighting, демонстрируя, как они меняют свои состояния в ответ на внутренние и внешние события. Она разделена на несколько отдельных конечных автоматов, каждый из которых описывает жизненный цикл или поведение конкретного аспекта игры.

### 1. Состояния врагов (Enemy States)

Этот конечный автомат описывает **комплексное адаптивное поведение** врагов в игре. Враги могут переключаться между различными состояниями в зависимости от текущей игровой ситуации, особенно от уровня их здоровья и взаимодействия с игроком.

* **Normal (Нормальное)**: Базовое состояние, в котором враг следует своей основной стратегии поведения (агрессивное, пассивное, трусливое). Переход в **Panic** происходит, когда здоровье врага опускается ниже 30%.
* **Panic (Паника)**: Враг пытается убежать от игрока, когда его здоровье критически низко. Как только здоровье восстанавливается выше 50%, враг переходит в состояние **Tracking**.
* **Tracking (Преследование)**: Враг пытается вернуться к месту последнего контакта с игроком. После достижения целевой позиции или если цель выходит из зоны досягаемости, враг переходит в состояние **Patrol** или возвращается в **Normal**.
* **Patrol (Патруль)**: Враг патрулирует область вокруг последней известной позиции игрока, ожидая восстановления или возможности вернуться к бою. Получение урона или завершение патрулирования возвращает его в **Normal** состояние.

### 2. Состояния игры (Game States)

Этот конечный автомат описывает **основной цикл** игрового процесса, от инициализации до завершения.

* **Init (Инициализация)**: Начальное состояние, в котором происходит загрузка и подготовка всех игровых ресурсов и генерация первого уровня.
* **PlayerTurn (Ход игрока)**: Игрок может выполнять действия (перемещение, атака, использование способностей).
* **EnemyTurn (Ход врагов)**: После хода игрока, все враги на карте выполняют свои действия.
* **Victory (Победа)**: Игра переходит в это состояние, когда игрок достигает выходной точки.
* **GameOver (Конец игры)**: Игра переходит в это состояние, когда здоровье игрока опускается до нуля.

Переходы между состояниями определяют логическую последовательность игрового цикла: `Init` -> `PlayerTurn` -> `EnemyTurn` -> `PlayerTurn` и так далее, до `Victory` или `GameOver`.

### 3. Состояния поведения врагов (Enemy Behaviors)

Этот конечный автомат фокусируется на временных эффектах, изменяющих базовое поведение врагов, в частности эффекте "спутанности".

* **Normal Behavior (Нормальное поведение)**: Враг использует свою стандартную стратегию поведения (агрессивную, пассивную и т.д.).
* **Confused Behavior (Спутанное поведение)**: Враг движется случайным образом в течение заданного количества ходов после применения способности "конфузия" игроком. После истечения срока действия эффект проходит, и враг возвращается к **Normal Behavior**.

Этот автомат демонстрирует, как паттерн **Декоратор** позволяет временно изменять поведение без изменения основной стратегии.

### 4. Жизненный цикл сущности (Entity Lifecycle)

Этот простой конечный автомат описывает базовый жизненный цикл любой сущности в игре (игрока, врага, предмета), связанный с её выживанием.

* **Alive (Живой)**: Сущность активна в игровом мире и взаимодействует с ним.
* **Dead (Мертвый)**: Сущность становится неактивной, когда её здоровье падает до нуля или ниже. После этого мертвые сущности обычно удаляются из игры.

### 5. Состояния реплицирующейся сущности (Replicating Entity)

Этот конечный автомат описывает специфическое поведение врагов, которые могут создавать свои копии.

* **Ready (Готов)**: Сущность готова к попытке репликации. Если попытка репликации успешна, сущность переходит в состояние **Cooldown**. Если нет, она остается в **Ready**.
* **Cooldown (Перезарядка)**: Сущность не может реплицироваться в течение определенного количества ходов (1-3). По истечении этого времени она возвращается в состояние **Ready**.