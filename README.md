# MastersOfDungeonFighting

```bash
npm install
npm run dev
```

## Общие сведения о системе
**MastersOfDungeonFighting** — это пошаговая двухмерная roguelike‑игра в стиле фэнтези, реализованная на TypeScript и предназначенная для запуска в браузере. В основе проекта лежит глубокое сочетание процедурной генерации подземелий, обеспечивающей высокую реиграбельность, и тактических пошаговых сражений на сетке, где каждое решение имеет значение. Игровой процесс дополняется развитой системой развития персонажа, позволяющей адаптировать героя под различные стили игры. Игровой мир наполнен разнообразными существами (скелеты, драконы, гоблины и др.), каждое из которых обладает уникальными характеристиками и адаптивным поведением, создавая динамичные и непредсказуемые столкновения.

## Architectural drivers

**Функциональные требования**:
- **Управление игроком**: Персонаж игрока управляется с клавиатуры и может перемещаться по карте.
- **Генерация и загрузка карт**: Игровая карта преимущественно генерируется процедурно (с использованием шума Перлина), но для некоторых уровней предусмотрена возможность загрузки из файла.
- **Игровые характеристики**: Реализована система характеристик (здоровье, сила атаки, защита и т.д.) для игрока и сущностей.
- **Пошаговая механика**: Перемещение, боевые столкновения и разрешение действий происходят пошагово, по клеткам.
- **Система прогрессии**: Механика опыта и уровней (XP) с ростом характеристик игрока при повышении уровня и возможностью улучшения экипировки.
- **Разнообразие поведения мобов**: Реализация различных стратегий поведения для врагов: агрессивное, пассивное, трусливое.
- **Динамические состояния мобов**: Сложная система состояний для мобов 
- **Временные эффекты** (например, конфузия), влияющие на поведение мобов
- **Регенерация здоровья мобов**: Постепенное восстановление здоровья у мобов со временем.
- **Репликация врагов**: Некоторые враги могут создавать свои копии на соседних клетках.
- **Система инвентаря**: Персонаж имеет инвентарь (10 слотов) для экипировки и предметов, влияющих на характеристики.

**Нефункциональные требования**:
- **Расширяемость**: Система должна быть легко расширяема для добавления новых типов сущностей (врагов, предметов), поведений, состояний, а также новых тем оформления и механик без существенного изменения существующей кодовой базы.
- **Производительность**: игра должна обеспечивать плавное пошаговое взаимодействие без заметных задержек, особенно при генерации карт и обработке ходов большого количества сущностей.
- **Удобство использования**:
  - *Интуитивное управление*: Управление игроком и взаимодействие с инвентарем должны быть простыми и интуитивно понятными для широкого круга пользователей.
  - *Четкий UI*: Игровой интерфейс (карта, панель статуса, инвентарь, магазин) должен быть информативным и легко читаемым.
- **Адаптивность**: Система должна позволять легко менять "тему" игры (например, фэнтези на лес) без значительных переработок логики, что достигается за счет фабрик и стратегий.

**Ограничения**:
- **Платформа**: Игра должна быть реализована для запуска исключительно в веб-браузере, что накладывает ограничения на доступ к файловой системе, производительность и используемые технологии.
- **Тип игры**: Жесткое следование парадигме roguelike (перманентная смерть, процедурная генерация, пошаговость) и 2D top-down представлению.
- **Графика**: Ограничение на 2D графику, что упрощает рендеринг и снижает нагрузку на браузер.

### Game design:

**Карта**: 2d top-down клетки, случайная генерация (шум перлина), видимая область (поле 30х30), внешние границы (330х330 то есть 11х11 полей) 

**Персонаж**: перемещение на стрелочки или WASD, атака на стрелочки в направление врага или ответная атака. Space - пропустить ход. C - "конфузить" ближайших врагов.

**Мобы**: 
* Случайная генерация в зоне при заходе на новое поле
* Три основные категории: обычные, элитные, реплицирующиеся
* Три типа поведения: агрессивное, пассивное, трусливое
* Сложная система состояний:
  * В нормальном состоянии используют базовую стратегию поведения
  * При падении здоровья ниже 30% переходят в режим паники и убегают
  * После восстановления здоровья выше 50% возвращаются к месту последнего боя
  * Патрулируют область вокруг этой точки некоторое время
  * При получении урона во время патрулирования возвращаются к нормальному состоянию
  * Могут быть "конфужены" игроком, что заставляет их двигаться случайно некоторое время
* Здоровье мобов постепенно восстанавливается со временем
* Чем дальше поле от стартового в Манхэттенском расстоянии, тем больше HP и урона у мобов
* Ограничение на количество мобов на карте
* Убитые мобы дают опыт
* Реплицирующиеся враги могут создавать свои копии на соседних клетках

**Предметы (инвентарь)**: 10 слотов. Выбросить предмет из инвентаря (правой кнопкой мыши). Подбор вещей - просто наступить на них.

**Магазин** (меню после смерти): по уровню и количеству монет можно купить экипировку или улучшить

## Роли и случаи использования

**Основные роли**:

* **Игрок** (Player):  Основной пользователь системы, который управляет главным героем, исследует уровни, вступает в бои, управляет инвентарём и принимает решения о развитии персонажа.
* **Тестировщик** (QA): Отвечает за верификацию и валидацию системы, включая написание и запуск unit-тестов, а также проверку корректности алгоритмов и общей функциональности игры.

**Случаи использования**:
1. **Запуск новой игры**: игрок запускает приложение, и система подготавливает первый игровой уровень. (Актор: Игрок)
2. **Исследование карты**: игрок перемещается по игровому полю, собирает монеты и подбирает предметы. (Актор: Игрок)
3. **Вступление в бой / Сражение с врагом**: игрок и враждебная сущность взаимодействуют на одной клетке, система рассчитывает урон и разрешает боевые действия на основе атрибутов. (Актор: Игрок)
4. **Управление инвентарём**: Игрок экипирует или использует предметы из инвентаря, а также может выбрасывать ненужные. (Актор: Игрок)
5. **Взаимодействие с магазином**: После поражения игрок переходит в главное меню, где может использовать накопленные средства для покупки или улучшения экипировки, а затем начать новую игру. (Актор: Игрок)
6. **Тестирование функциональности**: Тестировщик выполняет тесты для проверки корректности алгоритмов и общей работоспособности программы. (Актор: Тестировщик)

## Описание типичного пользователя

1  
**Имя**: Артем, 23 года  
**Профессия**: студент, репетитор, начинающий разработчик  
**Интересы**: 3D-моделирование, изучение новых игр и исследование их механик  
**Опыт в играх**: знаток рогаликов (Hades, Enter the Gungeon, Bullets Per Minute), в некоторых даже собрал 100% ачивок в стиме  

2  
**Имя**: Дядя Вася, 34 года  
**Профессия**: заводчанин  
**Интересы**: видеоигры + пивко  
**Опыт в играх**: обычно играет с корешами в кс/доту, но иногда пробует новые жанры (рпг, сюжетки, рогалики)  

3  
**Имя**: Никита, 15 лет  
**Профессия**: геймер  
**Интересы**: индустрия видеоигр (новости, GamesCon, …)  
**Опыт в играх**: играет 24/7, скачивает и играет во все свежие новинки, перепроходит с друзьями кооп-игры  
